Follow pdbj_README.txt in this directory from:

ftp://ftp.pdbj.org/mine/00README.txt
See in directory pdbj_mine parallel to this file.

For some reason on stella it was fine to set the max_locks_per_transaction to 256 whereas on nmr
it was an error and prevented the server to start up.

Read: http://shifteleven.com/articles/2008/03/21/installing-postgresql-on-leopard-using-macports

# stella
setenv PGDATA /Users/jd/opt/postgresql84/defaultdb
setenv PGBIN /Users/jd/opt/bin

# nmr
setenv PGDATA /pgdata
setenv PGBIN /usr/local/pgsql/bin


-- 1 -- Use Fix in http://shifteleven.com/articles/2008/03/21/installing-postgresql-on-leopard-using-macports
on: "The solution to the /dev/null error:"

sudo mkdir /Users/postgres
sudo chown postgres:postgres /Users/postgres
sudo dscl . -create /Users/postgres UserShell /bin/tcsh
sudo dscl . -create /Users/postgres NFSHomeDirectory /Users/postgres

--  2 -- Fix problem with getline. described here:
http://www.stereoplex.com/2008/feb/5/error-compiling-postgresql-83-on-leopard-rl_comple/
stella:
./configure --prefix=/Users/jd/opt --with-python --with-libxml --with-libxslt --with-libedit-preferred
nmr:
./configure --prefix=/usr/local/pgsql --with-python --with-libxml --with-libxslt --with-libedit-preferred

--->  Creating launchd control script
###########################################################
# A startup item has been generated that will aid in
# starting postgresql84-server with launchd. It is disabled
# by default. Execute the following command to start it,
# and to cause it to launch at startup:
#
# sudo launchctl load -w /Library/LaunchDaemons/org.macports.postgresql84-server.plist
###########################################################
--->  Installing postgresql84-server @8.4.1_0

To create a database instance, after install do
 sudo mkdir -p $PGDATA
 sudo chown postgres:postgres $PGDATA
 sudo su postgres -c 'initdb -D $PGDATA'

To tweak your DBMS, consider increasing kern.sysv.shmmax by adding an increased kern.sysv.shmmax .. to /etc/sysctl.conf

stella:
	sudo su postgres -c '/Users/jd/opt/bin/pg_ctl -D /Users/jd/opt/postgresql84/defaultdb -l /tmp/logfile start'
	sudo su postgres -c '/Users/jd/opt/bin/pg_ctl -D /Users/jd/opt/postgresql84/defaultdb stop'
nmr:
	sudo su postgres -c '/usr/local/pgsql/bin/pg_ctl -D /pgdata -l /tmp/pg_logfile start'
	sudo su postgres -c '/usr/local/pgsql/bin/pg_ctl -D /pgdata stop'


Connect as postgres unix user:
	psql
	create role nrgcing1 LOGIN CREATEDB SUPERUSER;
	alter database nrgcing owner to nrgcing1;

Connect as jd unix user:
	createdb nrgcing
	psql -l


-- Getting started help:
\? from the psql monitor
\l list db
\dt' list tables
\d atom list a table


- add PGDATA to exclusion list of spotlight and TM.
- Create file /etc/sysctl.conf with 1G (100 Mb now) and reboot:
NOTE THIS BELOW CRASHED TOMCAT JAVA ENVIRONMENT. SWITCHED BACK TO DEFAULT SETTINGS.
From: http://serverfault.com/questions/10226/how-to-set-the-shmmax-parameter-on-mac-os-x
kern.sysv.shmmax=524288000
kern.sysv.shmmin=1
kern.sysv.shmmni=64
kern.sysv.shmseg=16
kern.sysv.semmns=130
kern.sysv.shmall=131072000
kern.sysv.maxproc=2048
kern.maxprocperuid=512

on nmr using (fink recommends):
kern.sysv.shmmax=8388608
kern.sysv.shmmin=1
kern.sysv.shmmni=64
kern.sysv.shmseg=8
kern.sysv.shmall=32768

or for all shared memory related settings:
sysctl -a | grep shm
Or do on line but settings will not persist.
jd:nmr/~/ sudo sysctl -w kern.sysv.shmmax=104857600 DID THIS WORK?



It failed to reload the weekly run with setting of 256 as suggested so increased to:
max_locks_per_transaction = 1024
This was running 93 Mb (675 Mb uncompressed SQL)

Set a password:
http://www.postgresql.org/docs/8.3/interactive/libpq-pgpass.html